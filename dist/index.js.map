{"version":3,"file":"index.js","sources":["../lib/IdentityClient.js","../lib/TokenClient.js","../lib/TasksClient.js","../lib/index.js"],"sourcesContent":["/**\n * The IdentityClient class. Uses an Access Token to find the Org and Project Identity to which it belongs.\n */\nclass IdentityClient {\n  constructor (apiHost) {\n    this.apiHost = apiHost\n  }\n\n  /**\n   * Returns the Org and Project ID for a given access token.\n   * @param accessToken An access token\n   * @return {object}\n   */\n  async GetIdentity (accessToken) {\n    if (!accessToken) {\n      throw new Error(\n        'cannot get identity, expected access token to not be empty'\n      )\n    }\n    const res = await fetch(`https://${this.apiHost}/api/v1/whoami`, {\n      method: 'GET',\n      headers: {\n        Authorization: `Bearer ${accessToken}`\n      }\n    })\n    if (res.status !== 200) {\n      throw new Error(\n        `cannot get identity, expected 200 but got ${res.status}: ${res.statusText}`\n      )\n    }\n    const details = await res.json()\n    if (!details.client) {\n      throw new Error(\n        'cannot get identity, expected response to contain client details'\n      )\n    }\n    return details.client\n  }\n}\n\nexport default IdentityClient\n","/**\n * The TokenClient class. Performs a Client Credentials OAuth2 Grant for an given Client ID and Secret.\n */\nclass TokenClient {\n  constructor (authHost, clientID, clientSecret) {\n    this.authHost = authHost\n  }\n\n  /**\n   * Create an Access Token\n   * @param clientID The OAuth Client App ID.\n   * @param clientSecret The OAuth Client App Secret.\n   * @return {string}\n   */\n  async Create (clientID, clientSecret) {\n    const res = await fetch(`https://${this.authHost}/oauth2/token`, {\n      method: 'POST',\n      headers: {\n        Authorization: `Basic ${this.getBasicAuthorizationHeader(clientID, clientSecret)}`\n      },\n      body: this.getFormDataWithGrantType('client_credentials')\n    })\n    if (res.status !== 200) {\n      throw new Error(\n        `cannot create token, expected 200 but got ${res.status}: ${res.statusText}`\n      )\n    }\n    const data = await res.json()\n    if (!data.access_token) {\n      throw new Error(\n        'cannot create token, expected response to contain access token'\n      )\n    }\n    return data.access_token\n  }\n\n  /**\n   * @private\n   */\n  getBasicAuthorizationHeader (clientID, clientSecret) {\n    return btoa(`${clientID}:${clientSecret}`)\n  }\n\n  /**\n   * @private\n   */\n  getFormDataWithGrantType (grantType) {\n    const formData = new FormData()\n    formData.append('grant_type', grantType)\n    return formData\n  }\n}\n\nexport default TokenClient\n","const maxTaskInputLength = 128000\n\n/**\n * The TasksClient class. Performs various Tasks CRUD operations against the Rightbrain AI API.\n */\nclass TasksClient {\n  constructor (tokenClient, identityClient, apiHost, clientID, clientSecret) {\n    this.tokenClient = tokenClient\n    this.identityClient = identityClient\n    this.apiHost = apiHost\n    this.clientID = clientID\n    this.clientSecret = clientSecret\n  }\n\n  /**\n   * Creates a new Task\n   * @param definition A task definition as required by the API\n   * @return {object}\n   */\n  async Create (definition) {\n    const accessToken = await this.tokenClient.Create(this.clientID, this.clientSecret)\n    const response = await fetch(await this.getTaskCreateURL(accessToken), {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${accessToken}`\n      },\n      body: JSON.stringify(definition)\n    })\n    if (response.status !== 200) {\n      throw new Error(\n        `Error creating Task, expected status code of 200, but got ${response.status}: ${response.statusText}`\n      )\n    }\n    return await response.json()\n  }\n\n  /**\n   * Runs a Task\n   * @param taskID The ID of the Task to be ran.\n   * @param taskInput The Task Input required by the Task.\n   * @param taskRevision If supplied, the revision of the Task to be ran.\n   * @return {object}\n   */\n  async Run (taskID, taskInput, taskRevision) {\n    const data = JSON.stringify(taskInput)\n    this.assertTaskInputSize(data)\n    const accessToken = await this.authClient.CreateToken()\n    const response = await fetch(await this.getTaskRunURL(accessToken, taskID, taskRevision), {\n      method: 'POST',\n      headers: {\n        Authorization: `Bearer ${accessToken}`\n      },\n      body: this.getTaskInputFormData(data)\n    })\n    if (response.status !== 200) {\n      throw new Error(\n        `Error running Task, expected status code of 200, but got ${response.status}: ${response.statusText}`\n      )\n    }\n    return await response.json()\n  }\n\n  /**\n   * @private\n   */\n  async getTaskCreateURL (accessToken) {\n    const identity = await this.getIdentity(accessToken)\n    return `https://${this.apiHost}/api/v1/org/${identity.org_id}/project/${identity.project_id}/task`\n  }\n\n  /**\n   * @private\n   */\n  async getTaskRunURL (accessToken, taskID, taskRevision) {\n    const identity = await this.getIdentity(accessToken)\n    let url = `https://${this.apiHost}/api/v1/org/${identity.org_id}/project/${identity.project_id}/task/${taskID}/run`\n    if (taskRevision) {\n      url += `?revision=${taskRevision}`\n    }\n    return url\n  }\n\n  /**\n   * @private\n   */\n  assertTaskInputSize (taskInput) {\n    if (taskInput.length > maxTaskInputLength) {\n      throw new Error(`Error running task, max task input is ${maxTaskInputLength} but input was ${taskInput.length}`)\n    }\n  }\n\n  /**\n   * @private\n   */\n  getTaskInputFormData (taskInput) {\n    const formData = new FormData()\n    formData.append('task_input', taskInput)\n    return formData\n  }\n\n  /**\n   * @private\n   */\n  async getIdentity (accessToken) {\n    if (!this.cachedIdentity) {\n      this.cachedIdentity = await this.identityClient.GetIdentity(accessToken)\n    }\n    return this.cachedIdentity\n  }\n}\n\nexport default TasksClient\n","import IdentityClient from './IdentityClient.js'\nimport TokenClient from './TokenClient.js'\nimport TasksClient from './TasksClient.js'\n\nconst defaultTasksClientOptions = {\n  apiHost: 'app.rightbrain.ai',\n  authHost: 'oauth.rightbrain.ai',\n  clientID: null,\n  clientSecret: null\n}\n\n/**\n * Creates a new Tasks Client\n * @param options An object of options to replace the defaults.\n * @return {object}\n */\nfunction NewDefaultTasksClient (options) {\n  options = { ...defaultTasksClientOptions, ...options }\n  const identityClient = new IdentityClient(options.apiHost)\n  const tokenClient = new TokenClient(options.authHost)\n  return new TasksClient(tokenClient, identityClient, options.apiHost, options.clientID, options.clientSecret)\n}\n\nexport { NewDefaultTasksClient }\n"],"names":[],"mappings":"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"}